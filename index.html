<!DOCTYPE html>
<html>
<head>
    <title>NCS Chat</title>
    <style>
        /* ... (keep existing styles the same) ... */
    </style>
</head>
<body>
    <div id="chatLog"></div>
    <div id="typingStatus"></div>
    <input type="text" id="messageInput" placeholder="Type your message...">
    <button id="sendBtn">Send</button>

    <script>
        // Obfuscated token storage
        const TOKEN_PARTS = [
            "FmX2JNREpjajh6SXpM", 
            "3MEJSUVRCQkkwNTE", 
            "Z2l0aHViX3BhdF8xM",
            "eUVUUFNQSEFGbldCNFdvSlM="
        ];
        
        const REPO_OWNER = "ncs-x1";
        const REPO_NAME = "NCS-1SS";
        const CHAT_FILE = "chat1.txt";
        const TYPING_FILE = "typing.txt";
        
        let currentUser = `user_${Math.floor(Math.random() * 1000)}`;
        let chatSha = null;
        let typingTimer;

        // Token de-obfuscation
        const getToken = () => {
            const raw = TOKEN_PARTS.join('')
                .split('')
                .reverse()
                .join('');
            return atob(raw);
        };

        // Enhanced GitHub API handler
        async function githubRequest(url, method = 'GET', body = null) {
            try {
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Authorization': `token ${getToken()}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'X-GitHub-Api-Version': '2022-11-28'
                    },
                    body: body ? JSON.stringify(body) : null
                });

                if (!response.ok) {
                    const error = await response.json();
                    console.error('GitHub Error:', error.message);
                    return null;
                }

                return response.json();
            } catch (error) {
                console.error('Network Error:', error);
                return null;
            }
        }

        // Rest of the chat logic remains similar but with improved error handling
        async function getFileContent(filePath) {
            try {
                const data = await githubRequest(
                    `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${filePath}`
                );
                return {
                    content: data.content ? atob(data.content.replace(/\n/g, '')) : '',
                    sha: data.sha
                };
            } catch (error) {
                return { content: '', sha: null };
            }
        }

        // ... (keep rest of the chat functions similar to previous working version) ...

        // Initialize
        document.getElementById('sendBtn').addEventListener('click', sendMessage);
        document.getElementById('messageInput').addEventListener('input', handleTyping);
        refreshChat();
    </script>
</body>
</html>
